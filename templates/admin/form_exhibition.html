{% extends "admin/base_admin.html" %}

{% block title %}{{ action }} Exhibition{% endblock %}

{% block admin_content %}

<!-- PAGE HEADER -->
<div class="admin-page-header">
    <div class="admin-page-header-left">
        <h2 class="admin-page-title">üé≠ {{ action }} Exposition</h2>
        <p class="admin-page-subtitle">G√©rez les informations de cette exposition</p>
    </div>
    <div class="admin-page-actions">
        <a href="{{ url_for('admin_exhibitions') }}" class="admin-btn admin-btn-secondary">‚Üê Retour</a>
    </div>
</div>

<!-- FORM CONTAINER -->
<div class="admin-card">

            <form method="POST" class="admin-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="title">Titre *</label>
                    <input type="text" id="title" name="title" placeholder="Nom de l'exhibition" value="{{ exhibition[1] if exhibition else '' }}" required>
                </div>

                <div class="form-group">
                    <label for="location">Lieu *</label>
                    <input type="text" id="location" name="location" placeholder="Adresse ou ville" value="{{ exhibition[2] if exhibition else '' }}" required>
                </div>

                <div class="form-group">
                    <label for="date">Date *</label>
                    <input type="date" id="date" name="date" value="{{ exhibition[3] if exhibition else '' }}" required>
                </div>

                <div class="form-group">
                    <label for="start_time">Heure de d√©but</label>
                    <input type="time" id="start_time" name="start_time" value="{{ exhibition[7] if exhibition else '' }}" placeholder="14:00">
                </div>

                <div class="form-group">
                    <label for="end_time">Heure de fin</label>
                    <input type="time" id="end_time" name="end_time" value="{{ exhibition[8] if exhibition else '' }}" placeholder="18:00">
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" placeholder="Description g√©n√©rale de l'exposition">{{ exhibition[4] if exhibition else '' }}</textarea>
                </div>

                <div class="form-group">
                    <label for="venue_details">D√©tails du lieu</label>
                    <textarea id="venue_details" name="venue_details" placeholder="Nom de la galerie, √©tage, informations d'acc√®s...">{{ exhibition[9] if exhibition else '' }}</textarea>
                </div>

                <div class="form-group">
                    <label for="organizer">Organisateur</label>
                    <input type="text" id="organizer" name="organizer" placeholder="Nom de l'organisateur ou de la galerie" value="{{ exhibition[10] if exhibition else '' }}">
                </div>

                <div class="form-group">
                    <label for="entry_price">Prix d'entr√©e</label>
                    <input type="text" id="entry_price" name="entry_price" placeholder="Gratuit, 5‚Ç¨, etc." value="{{ exhibition[11] if exhibition else '' }}">
                </div>

                <div class="form-group">
                    <label for="contact_info">Informations de contact</label>
                    <textarea id="contact_info" name="contact_info" placeholder="Email, t√©l√©phone, site web...">{{ exhibition[12] if exhibition else '' }}</textarea>
                </div>

                <div class="form-group">
                    <label>Image</label>
                    <div class="file-input-wrapper" id="image-wrapper">
                        <input type="file" id="image" name="image" accept="image/*" onchange="previewImage(event)">
                        <span class="file-label">üìÅ Cliquez ou glissez-d√©posez une image</span>
                    </div>
                    {% if exhibition and exhibition[5] %}
                    <div id="preview-container" style="display: block;">
                        <img id="preview-image" src="{{ url_for('static', filename=exhibition[5]) }}" alt="Aper√ßu" class="preview-img">
                    </div>
                    {% else %}
                    <div id="preview-container" style="display: none;">
                        <img id="preview-image" src="" alt="Aper√ßu" class="preview-img">
                    </div>
                    {% endif %}
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-primary">{{ action }}</button>
                    <a href="{{ url_for('admin_exhibitions') }}" class="btn-secondary">Annuler</a>
                </div>
            </form>


            <div class="form-info">
                <h3>‚ÑπÔ∏è Informations</h3>
                <ul>
                    <li><strong>Obligatoires:</strong> Titre, Lieu, Date</li>
                    <li><strong>Facultatifs:</strong> Heures (d√©but/fin), Description, D√©tails du lieu, Organisateur, Prix d'entr√©e, Contact, Image</li>
                    <li>Les heures permettent d'afficher l'horaire pr√©cis de l'exposition</li>
                    <li>Les d√©tails du lieu compl√®tent l'adresse (√©tage, salle, acc√®s...)</li>
                    <li>Le prix peut √™tre "Gratuit" ou un montant (ex: "5‚Ç¨", "10‚Ç¨")</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Google Places API -->
<script src="https://maps.googleapis.com/maps/api/js?key={{ google_places_key }}&libraries=places"></script>
<script>
function initAutocomplete() {
    const input = document.getElementById('location');
    new google.maps.places.Autocomplete(input, { types: ['geocode'] });
}
document.addEventListener("DOMContentLoaded", initAutocomplete);

function previewImage(event) {
    const file = event.target.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = function(e){
            const preview = document.getElementById('preview-image');
            const container = document.getElementById('preview-container');
            preview.src = e.target.result;
            container.style.display = 'block';
        }
        reader.readAsDataURL(file);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const wrapper = document.getElementById('image-wrapper');
    const input = document.getElementById('image');

    wrapper.addEventListener('click', () => input.click());
    wrapper.addEventListener('dragover', e => { e.preventDefault(); wrapper.style.background = '#e0f2ff'; });
    wrapper.addEventListener('dragleave', e => { e.preventDefault(); wrapper.style.background = '#f9f9f9'; });
    wrapper.addEventListener('drop', e => {
        e.preventDefault();
        wrapper.style.background = '#f9f9f9';
        input.files = e.dataTransfer.files;
        previewImage({target: input});
    });
});
</script>

<style>
/* Form panel */
.form-panel {
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    max-width: 700px;
    margin: 20px auto;
}

.form-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.admin-form .form-group {
    margin-bottom: 15px;
}

.admin-form label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.admin-form input[type="text"],
.admin-form input[type="date"],
.admin-form textarea {
    width: 100%;
    padding: 8px 12px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 14px;
}

.admin-form textarea {
    resize: vertical;
    min-height: 100px;
}

/* Drag & drop input */
.file-input-wrapper {
    border: 2px dashed #ccc;
    border-radius: 5px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: background 0.2s;
}

.file-input-wrapper:hover {
    background: #f0f8ff;
}

.preview-img {
    max-width: 100%;
    max-height: 300px;
    margin-top: 10px;
}

.btn-primary {
    color: #fff;
    background-color: #007bff;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    text-decoration: none;
    font-size: 14px;
    margin-right: 10px;
}

.btn-primary:hover { background-color: #0069d9; }

.btn-secondary {
    color: #333;
    background-color: #f0f0f0;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    text-decoration: none;
}

.btn-secondary:hover { background-color: #e0e0e0; }

/* Form info */
.form-info { margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 5px; }
.form-info h3 { margin-bottom: 10px; }
.form-info ul { margin: 0; padding-left: 20px; }
</style>

{% endblock %}
