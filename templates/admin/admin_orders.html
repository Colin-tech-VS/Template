{% extends "admin/base_admin.html" %}

{% block title %}Commandes - Admin{% endblock %}

{% block admin_content %}

<!-- PAGE HEADER -->
<div class="admin-page-header">
    <div class="admin-page-header-left">
        <h2 class="admin-page-title">ğŸ“¦ Commandes</h2>
        <p class="admin-page-subtitle">{{ orders|length }} commande{{ 's' if orders|length > 1 else '' }} au total</p>
    </div>
    <div class="admin-page-actions">
        <a href="{{ url_for('admin_users') }}" class="admin-btn admin-btn-secondary">ğŸ‘¥ Utilisateurs</a>
    </div>
</div>

<!-- SEARCH FORM -->
<div class="admin-card" style="margin-bottom: 24px;">
    <form method="get" action="{{ url_for('admin_orders') }}" class="admin-search-form">
        <input type="text" name="q" placeholder="ğŸ” Rechercher par ID, client, email..." value="{{ request.args.get('q', '') }}" class="admin-search-input" style="width: 100%;">
        <button type="submit" class="admin-btn admin-btn-primary">Rechercher</button>
    </form>
</div>

<!-- ORDERS LIST -->
{% if orders %}
<div style="display: flex; flex-direction: column; gap: 16px;">
    {% for order in orders %}
    <div class="admin-card">
        <div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--color-border);">
            <div>
                <h3 style="margin: 0 0 4px 0; color: var(--color-text); font-size: 1.1rem;">Commande #{{ order.id }}</h3>
                <p style="margin: 0; font-size: 0.9rem; color: var(--color-text-secondary);">{{ order.order_date }}</p>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 1.25rem; font-weight: 700; color: var(--color-primary); margin-bottom: 4px;">{{ "%.2f"|format(order.total_price) }} â‚¬</div>
                <span class="status-badge status-{{ order.status|lower|replace(' ', '-') }}">{{ order.status }}</span>
            </div>
        </div>
        
        <!-- ORDER DETAILS -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px; padding: 12px; background: #f8fafc; border-radius: 8px;">
            <div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 4px;">Client</div>
                <div style="font-weight: 600; color: var(--color-text);">{{ order.customer_name }}</div>
            </div>
            <div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 4px;">Email</div>
                <div style="font-size: 0.9rem; color: var(--color-text);">{{ order.email }}</div>
            </div>
            <div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 4px;">Adresse</div>
                <div style="font-size: 0.9rem; color: var(--color-text);">{{ order.address }}</div>
            </div>
        </div>
        
        <!-- ORDER ITEMS -->
        {% if all_items[order.id] %}
        <div style="margin-bottom: 16px;">
            <div style="font-weight: 600; margin-bottom: 12px; color: var(--color-text);">Articles :</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px;">
                {% for item in all_items[order.id] %}
                <div style="display: flex; gap: 10px; padding: 10px; background: white; border: 1px solid var(--color-border); border-radius: 8px;">
                    <img src="{{ url_for('static', filename=item.image) }}" alt="{{ item.name }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px;">
                    <div style="flex: 1; font-size: 0.9rem;">
                        <div style="font-weight: 600; margin-bottom: 4px;">{{ item.name }}</div>
                        <div style="color: #6b7280;">{{ item.quantity }} Ã— {{ item.price }} â‚¬</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- ORDER ACTIONS -->
        <div style="display: flex; gap: 8px;">
            <a href="{{ url_for('admin_order_detail', order_id=order.id) }}" class="admin-btn admin-btn-primary" style="padding: 8px 16px; font-size: 0.9rem;">ğŸ‘ï¸ Voir dÃ©tails</a>
            
            {% if order.status != 'LivrÃ©' %}
            <form method="POST" action="{{ url_for('update_order_status', order_id=order.id, status='LivrÃ©') }}" style="display: inline;">
                <button type="submit" class="admin-btn admin-btn-secondary" style="padding: 8px 16px; font-size: 0.9rem;">âœ… Marquer LivrÃ©e</button>
            </form>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="admin-empty-state">
    <div class="admin-empty-icon">ğŸ“¦</div>
    <h3 class="admin-empty-title">Aucune commande</h3>
    <p class="admin-empty-message">Aucune commande trouvÃ©e</p>
</div>
{% endif %}

{% endblock %}
