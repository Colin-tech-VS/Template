{% extends "admin/base_admin.html" %}

{% block title %}Dashboard - Admin{% endblock %}

{% block admin_content %}

<!-- PAGE HEADER -->
<div class="admin-page-header">
    <div class="admin-page-header-left">
        <h2 class="admin-page-title">üìä Dashboard</h2>
        <p class="admin-page-subtitle">Vue d'ensemble de votre activit√©</p>
    </div>
</div>

<!-- STATISTICS GRID -->
<div class="admin-grid admin-grid-4">
    <div class="stat-card">
        <div class="stat-icon">üñºÔ∏è</div>
        <div class="stat-content">
            <p class="stat-label">Peintures</p>
            <p class="stat-value">{{ total_paintings }}</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">üì¶</div>
        <div class="stat-content">
            <p class="stat-label">Commandes</p>
            <p class="stat-value">{{ total_orders }}</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-content">
            <p class="stat-label">Revenu Total</p>
            <p class="stat-value">{{ "%.2f"|format(total_revenue) }} ‚Ç¨</p>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">üë•</div>
        <div class="stat-content">
            <p class="stat-label">Utilisateurs</p>
            <p class="stat-value">{{ total_users }}</p>
        </div>
    </div>
</div>

<!-- OUT OF STOCK ALERT -->
{% if out_of_stock %}
<div class="admin-alert admin-alert-warning">
    <div class="admin-alert-icon">‚ö†Ô∏è</div>
    <div class="admin-alert-content">
        <h3 class="admin-alert-title">Ruptures de Stock ({{ out_of_stock|length }})</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">
            {% for painting in out_of_stock %}
            <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px; background: rgba(255,255,255,0.6); border-radius: 8px;">
                <div>
                    <strong style="color: #1f2937;">{{ painting.name }}</strong>
                    <p style="margin: 4px 0 0 0; font-size: 0.9rem; color: #6b7280;">{{ painting.quantity }} unit√©s</p>
                </div>
                <div style="display: flex; gap: 8px;">
                    <a href="{{ url_for('edit_painting', painting_id=painting.id) }}" class="admin-btn admin-btn-secondary" style="padding: 6px 12px; font-size: 0.85rem;">‚úèÔ∏è √âditer</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<!-- RECENT ORDERS SECTION -->
<div class="admin-card" style="margin-top: 32px;">
    <div class="admin-card-header">
        <div>
            <h3 class="admin-card-title">üì¶ Commandes R√©centes</h3>
            <p class="admin-card-subtitle">{{ recent_orders|length }} commande{{ 's' if recent_orders|length > 1 else '' }} r√©cente{{ 's' if recent_orders|length > 1 else '' }}</p>
        </div>
        <a href="{{ url_for('admin_orders') }}" class="admin-btn admin-btn-secondary">Voir tous ‚Üí</a>
    </div>
    
    {% if recent_orders %}
    <div class="admin-table-container">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Client</th>
                    <th>Email</th>
                    <th>Montant</th>
                    <th>Date</th>
                    <th>Statut</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for order in recent_orders %}
                <tr>
                    <td><strong>#{{ order.id }}</strong></td>
                    <td>{{ order.customer_name }}</td>
                    <td style="font-size: 0.9rem; color: #6b7280;">{{ order.email }}</td>
                    <td><strong>{{ "%.2f"|format(order.total) }} ‚Ç¨</strong></td>
                    <td>{{ order.date }}</td>
                    <td><span class="status-badge status-{{ order.status|lower|replace(' ', '-') }}">{{ order.status }}</span></td>
                    <td><a href="{{ url_for('admin_orders') }}">Voir ‚Üí</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="admin-empty-state">
        <div class="admin-empty-icon">üì¶</div>
        <h3 class="admin-empty-title">Aucune commande</h3>
        <p class="admin-empty-message">Aucune commande pour le moment</p>
    </div>
    {% endif %}
</div>

<!-- PRODUCTS GRID -->
<div class="admin-grid admin-grid-2" style="margin-top: 32px;">
    <!-- TOP SELLING PRODUCTS -->
    <div class="admin-card">
        <div class="admin-card-header">
            <div>
                <h3 class="admin-card-title">üèÜ Top 5 Produits Vendus</h3>
                <p class="admin-card-subtitle">Les plus commercialis√©s</p>
            </div>
        </div>
        
        {% if top_selling %}
        <div style="display: flex; flex-direction: column; gap: 12px;">
            {% for product in top_selling %}
            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid var(--color-border);">
                <div style="flex-shrink: 0;">
                    <img src="{{ url_for('static', filename=product.image) }}" alt="{{ product.name }}" style="width: 50px; height: 50px; border-radius: 6px; object-fit: cover;">
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; color: var(--color-text);">{{ product.name }}</div>
                    <div style="font-size: 0.85rem; color: #6b7280;">{{ product.total_sold }} vendues</div>
                </div>
                <div style="text-align: right; font-weight: 600; color: var(--color-primary);">{{ "%.2f"|format(product.price) }} ‚Ç¨</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="admin-empty-state">
            <div class="admin-empty-icon">üìä</div>
            <p class="admin-empty-message">Aucune vente enregistr√©e</p>
        </div>
        {% endif %}
    </div>
    
    <!-- TOP FAVORITE PRODUCTS -->
    <div class="admin-card">
        <div class="admin-card-header">
            <div>
                <h3 class="admin-card-title">‚ù§Ô∏è Top 5 Produits Aim√©s</h3>
                <p class="admin-card-subtitle">Les plus ajout√©s en favoris</p>
            </div>
        </div>
        
        {% if most_loved %}
        <div style="display: flex; flex-direction: column; gap: 12px;">
            {% for product in most_loved %}
            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #f8fafc; border-radius: 8px; border: 1px solid var(--color-border);">
                <div style="flex-shrink: 0;">
                    <img src="{{ url_for('static', filename=product.image) }}" alt="{{ product.name }}" style="width: 50px; height: 50px; border-radius: 6px; object-fit: cover;">
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; color: var(--color-text);">{{ product.name }}</div>
                    <div style="font-size: 0.85rem; color: #6b7280;">‚ù§Ô∏è {{ product.favorite_count }} favoris</div>
                </div>
                <div style="text-align: right; font-weight: 600; color: var(--color-primary);">{{ "%.2f"|format(product.price) }} ‚Ç¨</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="admin-empty-state">
            <div class="admin-empty-icon">‚ù§Ô∏è</div>
            <p class="admin-empty-message">Aucun favori enregistr√©</p>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}
