{% extends "admin/base_admin.html" %}

{% block title %}DÃ©tails Commande #{{ order[0] }} - Admin{% endblock %}

{% block admin_content %}

<!-- PAGE HEADER -->
<div class="admin-page-header">
    <div class="admin-page-header-left">
        <h2 class="admin-page-title">ğŸ“¦ Commande #{{ order[0] }}</h2>
        <p class="admin-page-subtitle">{{ order[5] }}</p>
    </div>
    <div class="admin-page-actions">
        <a href="{{ url_for('admin_orders') }}" class="admin-btn admin-btn-secondary">â† Retour aux commandes</a>
    </div>
</div>

<!-- CLIENT INFORMATION -->
<div class="admin-grid admin-grid-2">
    <div class="admin-card">
        <div class="admin-card-header">
            <div>
                <h3 class="admin-card-title">ğŸ“‹ Informations Client</h3>
            </div>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 12px;">
            <div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 4px;">Nom</div>
                <div style="font-weight: 600; color: var(--color-text);">{{ order[1] }}</div>
            </div>
            <div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 4px;">Email</div>
                <div style="font-weight: 600; color: var(--color-text);">{{ order[2] }}</div>
            </div>
            <div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 4px;">Adresse</div>
                <div style="font-weight: 600; color: var(--color-text);">{{ order[3] }}</div>
            </div>
            <div style="display: flex; gap: 8px;">
                <a href="mailto:{{ order[2] }}" class="admin-btn admin-btn-secondary" style="flex: 1;">âœ‰ï¸ Contacter</a>
            </div>
        </div>
    </div>
    
    <div class="admin-card">
        <div class="admin-card-header">
            <div>
                <h3 class="admin-card-title">ğŸ’° RÃ©sumÃ© Commande</h3>
            </div>
        </div>
        
        <div style="display: flex; flex-direction: column; gap: 12px;">
            <div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 4px;">Montant Total</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--color-primary);">{{ "%.2f"|format(order[4]) }} â‚¬</div>
            </div>
            <div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-bottom: 4px;">Statut</div>
                <span class="status-badge status-{{ order[6]|lower|replace(' ', '-') }}">{{ order[6] }}</span>
            </div>
            <div style="display: flex; flex-direction: column; gap: 8px;">
                <a href="{{ url_for('download_invoice', order_id=order[0]) }}" class="admin-btn admin-btn-primary" style="width: 100%;">ğŸ“„ TÃ©lÃ©charger facture</a>
            </div>
        </div>
    </div>
</div>

<!-- ORDER ITEMS -->
<div class="admin-card" style="margin-top: 24px;">
    <div class="admin-card-header">
        <div>
            <h3 class="admin-card-title">ğŸ“¦ Articles CommandÃ©s</h3>
            <p class="admin-card-subtitle">{{ items|length }} article{{ 's' if items|length > 1 else '' }}</p>
        </div>
    </div>
    
    {% if items %}
    <div class="admin-table-container">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Produit</th>
                    <th>QuantitÃ©</th>
                    <th>Prix Unitaire</th>
                    <th>Sous-total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td><strong>{{ item[1] }}</strong></td>
                    <td>{{ item[4] }}</td>
                    <td>{{ "%.2f"|format(item[3]) }} â‚¬</td>
                    <td><strong>{{ "%.2f"|format(item[3]*item[4]) }} â‚¬</strong></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>

<!-- ORDER STATUS MANAGEMENT -->
<div class="admin-card" style="margin-top: 24px;">
    <div class="admin-card-header">
        <div>
            <h3 class="admin-card-title">âš™ï¸ Changer le Statut</h3>
            <p class="admin-card-subtitle">Statut actuel: <strong>{{ order[6] }}</strong></p>
        </div>
    </div>
    
    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
        {% set statuses = ['En cours', 'ConfirmÃ©e', 'ExpÃ©diÃ©e', 'LivrÃ©e', 'AnnulÃ©e'] %}
        {% for status in statuses %}
            {% if status != order[6] %}
            <a href="{{ url_for('update_order_status', order_id=order[0], status=status) }}" class="admin-btn admin-btn-secondary">{{ status }}</a>
            {% else %}
            <button disabled class="admin-btn admin-btn-primary" style="opacity: 0.6;">âœ“ {{ status }}</button>
            {% endif %}
        {% endfor %}
    </div>
</div>

{% endblock %}
