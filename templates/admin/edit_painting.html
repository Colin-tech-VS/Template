{% extends "base.html" %}

{% block title %}√âditer une peinture - Admin{% endblock %}

{% block content %}

<!-- HEADER ADMIN -->
<header class="admin-header">
    <div class="admin-container">
        <h1>üé® Tableau de bord Admin</h1>
        <nav class="admin-nav">
            <a href="{{ url_for('admin_dashboard') }}" class="nav-btn {% if active=='dashboard' %}active{% endif %}">Dashboard</a>
            <a href="{{ url_for('admin_paintings') }}" class="nav-btn {% if active=='paintings' %}active{% endif %}">Peintures</a>
            <a href="{{ url_for('admin_orders') }}" class="nav-btn {% if active=='orders' %}active{% endif %}">Commandes</a>
            <a href="{{ url_for('admin_users') }}" class="nav-btn {% if active=='users' %}active{% endif %}">Utilisateurs</a>
            <a href="{{ url_for('admin_exhibitions') }}" class="nav-btn {% if active=='exhibitions' %}active{% endif %}">Exhibitions</a>
            <a href="{{ url_for('admin_custom_requests') }}" class="nav-btn {% if active=='custom_requests' %}active{% endif %}">Demandes sur Mesure</a>
            <a href="{{ url_for('admin_notifications') }}" class="nav-btn {% if active=='notifications' %}active{% endif %}">
                üîî Notifications
                {% if new_notifications_count > 0 %}
                <span class="badge">{{ new_notifications_count }}</span>
                {% endif %}
            </a>
            <!-- Nouvel onglet Param√®tres -->
            <a href="{{ url_for('admin_settings_page') }}" class="nav-btn {% if active=='settings' %}active{% endif %}">‚öôÔ∏è Param√®tres</a>

            <a href="{{ url_for('add_painting_web') }}" class="nav-btn btn-primary">+ Ajouter</a>
        </nav>
    </div>
</header>


<!-- FORMULAIRE -->
<section class="admin-section">
    <div class="admin-container">
        <div class="form-panel">
            <div class="form-header">
                <h2>Peinture #{{ painting[0] }} - {{ painting[1] }}</h2>
                <a href="{{ url_for('admin_paintings') }}" class="btn-secondary">‚Üê Retour</a>
            </div>

            <form method="POST" class="admin-form" enctype="multipart/form-data">
                <!-- IMAGES -->
                <div class="form-section">
                    <h3>üñºÔ∏è Images</h3>
                    
                    <!-- IMAGE PRINCIPALE -->
                    <div class="form-group">
                        <label>Image principale actuelle</label>
                        <div class="image-preview" style="max-width:300px;">
                            <img src="{{ url_for('static', filename=painting[2]) }}" alt="{{ painting[1] }}" class="preview-img" id="preview-main">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="image">Changer l'image principale</label>
                        <div class="file-input-wrapper" onclick="document.getElementById('image').click()">
                            <input type="file" id="image" name="image" accept="image/*" onchange="previewImage(this, 'preview-main')">
                            <span class="file-label">üì∏ Cliquez pour t√©l√©charger</span>
                        </div>
                    </div>

                    <!-- IMAGES ADDITIONNELLES -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="image_2">Image 2 (optionnelle)</label>
                            {% if painting[13] %}
                            <img src="{{ url_for('static', filename=painting[13]) }}" alt="Image 2" class="preview-img-small" id="preview-2" style="max-width:150px;">
                            {% else %}
                            <img src="" alt="" class="preview-img-small" id="preview-2" style="max-width:150px; display:none;">
                            {% endif %}
                            <input type="file" id="image_2" name="image_2" accept="image/*" onchange="previewImage(this, 'preview-2')">
                        </div>

                        <div class="form-group">
                            <label for="image_3">Image 3 (optionnelle)</label>
                            {% if painting[14] %}
                            <img src="{{ url_for('static', filename=painting[14]) }}" alt="Image 3" class="preview-img-small" id="preview-3" style="max-width:150px;">
                            {% else %}
                            <img src="" alt="" class="preview-img-small" id="preview-3" style="max-width:150px; display:none;">
                            {% endif %}
                            <input type="file" id="image_3" name="image_3" accept="image/*" onchange="previewImage(this, 'preview-3')">
                        </div>

                        <div class="form-group">
                            <label for="image_4">Image 4 (optionnelle)</label>
                            {% if painting[15] %}
                            <img src="{{ url_for('static', filename=painting[15]) }}" alt="Image 4" class="preview-img-small" id="preview-4" style="max-width:150px;">
                            {% else %}
                            <img src="" alt="" class="preview-img-small" id="preview-4" style="max-width:150px; display:none;">
                            {% endif %}
                            <input type="file" id="image_4" name="image_4" accept="image/*" onchange="previewImage(this, 'preview-4')">
                        </div>
                    </div>
                </div>

                <!-- INFORMATIONS G√âN√âRALES -->
                <div class="form-section">
                    <h3>üìù Informations g√©n√©rales</h3>
                    
                    <!-- NOM -->
                    <div class="form-group">
                        <label for="name">Nom de la peinture *</label>
                        <input type="text" id="name" name="name" value="{{ painting[1] }}" required>
                    </div>

                    <!-- CAT√âGORIE ET STATUT -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="category">Cat√©gorie</label>
                            <select id="category" name="category">
                                <option value="">-- S√©lectionner --</option>
                                <option value="Abstrait" {% if painting[11] == 'Abstrait' %}selected{% endif %}>Abstrait</option>
                                <option value="Paysage" {% if painting[11] == 'Paysage' %}selected{% endif %}>Paysage</option>
                                <option value="Portrait" {% if painting[11] == 'Portrait' %}selected{% endif %}>Portrait</option>
                                <option value="Nature morte" {% if painting[11] == 'Nature morte' %}selected{% endif %}>Nature morte</option>
                                <option value="Moderne" {% if painting[11] == 'Moderne' %}selected{% endif %}>Moderne</option>
                                <option value="Figuratif" {% if painting[11] == 'Figuratif' %}selected{% endif %}>Figuratif</option>
                                <option value="Contemporain" {% if painting[11] == 'Contemporain' %}selected{% endif %}>Contemporain</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="status">Statut</label>
                            <select id="status" name="status">
                                <option value="">-- S√©lectionner --</option>
                                <option value="Disponible" {% if painting[12] == 'Disponible' %}selected{% endif %}>Disponible</option>
                                <option value="Vendu" {% if painting[12] == 'Vendu' %}selected{% endif %}>Vendu</option>
                                <option value="R√©serv√©" {% if painting[12] == 'R√©serv√©' %}selected{% endif %}>R√©serv√©</option>
                                <option value="Exposition" {% if painting[12] == 'Exposition' %}selected{% endif %}>En exposition</option>
                            </select>
                        </div>
                    </div>

                    <!-- PRIX ET QUANTIT√â -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="price">Prix (‚Ç¨) *</label>
                            <input type="number" id="price" name="price" value="{{ painting[3] }}" min="0" step="0.01" required>
                        </div>

                        <div class="form-group">
                            <label for="quantity">Quantit√© en stock *</label>
                            <input type="number" id="quantity" name="quantity" value="{{ painting[4] }}" min="0" required>
                        </div>
                    </div>

                    <!-- DESCRIPTION COURTE -->
                    <div class="form-group">
                        <label for="description">Description courte</label>
                        <textarea id="description" name="description" rows="3">{{ painting[5] or '' }}</textarea>
                    </div>

                    <!-- DESCRIPTION LONGUE -->
                    <div class="form-group">
                        <label for="description_long">Description d√©taill√©e</label>
                        <textarea id="description_long" name="description_long" rows="6">{{ painting[7] or '' }}</textarea>
                    </div>
                </div>

                <!-- CARACT√âRISTIQUES TECHNIQUES -->
                <div class="form-section">
                    <h3>üé® Caract√©ristiques techniques</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dimensions">Dimensions (ex: 50x70 cm)</label>
                            <input type="text" id="dimensions" name="dimensions" value="{{ painting[8] or '' }}" placeholder="50x70 cm">
                        </div>

                        <div class="form-group">
                            <label for="technique">Technique</label>
                            <input type="text" id="technique" name="technique" value="{{ painting[9] or '' }}" placeholder="Huile sur toile">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="year">Ann√©e</label>
                            <input type="text" id="year" name="year" value="{{ painting[10] or '' }}" placeholder="2024">
                        </div>

                        <div class="form-group">
                            <label for="weight">Poids (ex: 2 kg)</label>
                            <input type="text" id="weight" name="weight" value="{{ painting[16] or '' }}" placeholder="2 kg">
                        </div>
                    </div>
                </div>

                <!-- OPTIONS SP√âCIALES -->
                <div class="form-section">
                    <h3>‚≠ê Options sp√©ciales</h3>
                    
                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="unique_piece" value="1" {% if painting[19] %}checked{% endif %}>
                            <span>üéØ Pi√®ce unique</span>
                        </label>
                    </div>

                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="certificate" value="1" {% if painting[18] %}checked{% endif %}>
                            <span>üìú Avec certificat d'authenticit√©</span>
                        </label>
                    </div>

                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="framed" value="1" {% if painting[17] %}checked{% endif %}>
                            <span>üñºÔ∏è Encadr√©e</span>
                        </label>
                    </div>
                </div>

                <!-- ACTIONS -->
                <div class="form-actions">
                    <button type="submit" class="btn-primary">üíæ Enregistrer les modifications</button>
                    <a href="{{ url_for('admin_paintings') }}" class="btn-secondary">Annuler</a>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- SCRIPT PREVIEW IMAGE -->
<script>
function previewImage(input, previewId) {
    const preview = document.getElementById(previewId);
    const file = input.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = e => {
            preview.src = e.target.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}
</script>

<style>
/* SECTIONS */
.form-section {
    background: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 25px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.form-section h3 {
    font-size: 20px;
    font-weight: 600;
    color: #1E3A8A;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e5e7eb;
}

/* CHECKBOXES */
.checkbox-group {
    margin: 15px 0;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    padding: 12px;
    background: #f9fafb;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.checkbox-label:hover {
    background: #f3f4f6;
}

.checkbox-label input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.checkbox-label span {
    font-size: 16px;
    font-weight: 500;
    color: #374151;
}

/* IMAGES SMALL */
.preview-img-small {
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin: 10px 0;
}

/* STYLE FILE INPUT WRAPPER */
.file-input-wrapper {
    position: relative;
    border: 2px dashed #1E3A8A;
    border-radius: 8px;
    padding: 30px 20px;
    text-align: center;
    background: #f9f9f9;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100px;
}
.file-input-wrapper:hover { background: #f0f4f8; border-color: #3B65C4; }
.file-input-wrapper.drag-over { background: #e0f2ff; border-color: #1E3A8A; }
.file-input-wrapper input { display: none; }
.file-label { color: #1E3A8A; font-weight: 600; font-size: 14px; cursor: pointer; }

/* IMAGE PREVIEW */
.preview-img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-top: 10px;
}

/* SELECT STYLING */
select {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 14px;
    color: #374151;
    background: white;
    cursor: pointer;
}

select:focus {
    outline: none;
    border-color: #1E3A8A;
    box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
}
</style>

{% endblock %}
